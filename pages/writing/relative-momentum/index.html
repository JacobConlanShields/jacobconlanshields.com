<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="https://pub-aad15324564c43c49955b96d781f71eb.r2.dev/JCS%20Logo%20Black%20Background.png" />
  <title>Relative Momentum — Jacob Conlon Shields</title>
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    body {
      font-size: 15px;
    }

    h1 {
      margin-bottom: 2px;
    }

    .viewer-intro {
      margin-top: 2px;
      margin-bottom: 4px;
    }

    .viewer {
      margin-top: 6px;
      display: grid;
      gap: 6px;
      --page-max-height: 460px;
      width: min(1200px, 100%);
      margin-left: auto;
      margin-right: auto;
    }

    .viewer-controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-bottom: 0;
      margin-left: auto;
    }

    .viewer-controls .btn {
      min-width: 120px;
      text-align: center;
    }

    .viewer-controls .icon-btn {
      min-width: auto;
    }

    .buy-row {
      position: relative;
      z-index: 5;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 2px;
      margin-bottom: 2px;
      width: min(1200px, 100%);
      margin-left: auto;
      margin-right: auto;
    }

    .buy-row .btn {
      margin: 0;
    }

    .loading-indicator {
      font-size: 0.95rem;
      opacity: 0.8;
      min-height: 1.2em;
    }

    .spread {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-items: center;
      transition: opacity 220ms ease, transform 220ms ease;
      position: relative;
      z-index: 1;
      margin-top: 0;
      perspective: 1200px;
    }

    .spread.turning {
      opacity: 0.2;
      transform: translateX(12px);
    }

    .page-frame {
      touch-action: pan-y;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.2);
      padding: 6px;
      border-radius: 10px;
      min-height: 220px;
      max-height: var(--page-max-height, min(70vh, 680px));
      height: var(--page-max-height, min(70vh, 680px));
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: zoom-in;

    }

    .page-sheet {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(10, 10, 10, 0.45);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
      transform-origin: left center;
      transform-style: preserve-3d;
      will-change: transform;
    }

    .page-shade {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        90deg,
        rgba(0, 0, 0, 0.08) 0%,
        rgba(0, 0, 0, 0) 55%,
        rgba(255, 255, 255, 0.06) 70%,
        rgba(0, 0, 0, 0.12) 100%
      );
      opacity: 0;
      transition: opacity 220ms ease;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .spread.turning[data-direction="forward"] .page-sheet {
      animation: pageTurnForward 520ms ease;
    }

    .spread.turning[data-direction="backward"] .page-sheet {
      animation: pageTurnBackward 520ms ease;
    }

    @keyframes pageTurnForward {
      0% {
        transform: rotateY(0deg) translateX(0);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          0 0 0 rgba(0, 0, 0, 0);
      }
      40% {
        transform: rotateY(-14deg) translateX(-4px);
        box-shadow: inset -50px 0 60px rgba(0, 0, 0, 0.5),
          -6px 0 12px rgba(0, 0, 0, 0.25);
      }
      100% {
        transform: rotateY(0deg);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          0 0 0 rgba(0, 0, 0, 0);
      }
    }

    @keyframes pageTurnBackward {
      0% {
        transform: rotateY(0deg) translateX(0);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          0 0 0 rgba(0, 0, 0, 0);
      }
      40% {
        transform: rotateY(14deg) translateX(4px);
        box-shadow: inset 50px 0 60px rgba(0, 0, 0, 0.5),
          6px 0 12px rgba(0, 0, 0, 0.25);
      }
      100% {
        transform: rotateY(0deg);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          0 0 0 rgba(0, 0, 0, 0);
      }
    }

    .spread.turning[data-direction="forward"] .page-shade,
    .spread.turning[data-direction="backward"] .page-shade {
      opacity: 1;
      animation: pageShade 520ms ease;
    }

    @keyframes pageShade {
      0% {
        opacity: 0.15;
      }
      45% {
        opacity: 0.55;
      }
      100% {
        opacity: 0.1;
      }
    }

    .page-frame img {
      width: 100%;
      height: auto;
      max-height: 100%;
      object-fit: contain;
      display: block;
      border-radius: 6px;
    }

    .missing-page {
      font-size: 0.95rem;
      text-align: center;
      opacity: 0.7;
      padding: 12px;
    }

    .progress-wrap {
      margin-top: 10px;
    }

    .progress-slider {
      width: 100%;
      appearance: none;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0.85) 0%,
        rgba(255, 255, 255, 0.85) var(--progress, 0%),
        rgba(255, 255, 255, 0.15) var(--progress, 0%),
        rgba(255, 255, 255, 0.15) 100%
      );
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .progress-slider::-webkit-slider-thumb {
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.85);
      border: 2px solid rgba(0, 0, 0, 0.3);
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    .progress-slider::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.85);
      border: 2px solid rgba(0, 0, 0, 0.3);
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    .fullscreen-modal .modal-card {
      width: min(1280px, 98vw);
      margin: 2.5vh auto 0;
      padding: 16px;
      max-height: 94vh;
      display: flex;
      flex-direction: column;
    }

    .fullscreen-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }

    .fullscreen-header h2 {
      font-size: 1.1rem;
      margin: 0;
    }

    .fullscreen-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-left: auto;
    }

    .fullscreen-actions .modal-close {
      position: static;
    }

    .fullscreen-viewer .spread {
      margin-top: 2px;
    }

    .fullscreen-viewer {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: min(1200px, 100%);
      margin: 0 auto;
    }

    .fullscreen-viewer .spread {
      flex: 1;
    }

    .fullscreen-viewer .progress-wrap {
      margin-top: 4px;
      padding-bottom: 6px;
    }

    .icon-btn[data-tooltip] {
      position: relative;
    }

    .icon-btn[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: calc(100% + 8px);
      right: 0;
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 8px;
      white-space: nowrap;
      opacity: 0;
      transform: translateY(4px);
      pointer-events: none;
      transition: opacity 120ms ease, transform 120ms ease;
      transition-delay: 90ms;
      z-index: 20;
    }

    .icon-btn[data-tooltip]:hover::after,
    .icon-btn[data-tooltip]:focus-visible::after {
      opacity: 1;
      transform: translateY(0);
    }

    .zoom-modal .modal-card {
      width: min(980px, 96vw);
      margin: 0 auto;
      padding: 18px;
      height: 100vh;
      max-height: 100vh;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .zoom-modal .zoom-image {
      width: 100%;
      height: auto;
      max-height: calc(100vh - 64px);
      object-fit: contain;
      display: block;
      border-radius: 12px;
    }

    @media (max-width: 899px) {
      body {
        font-size: 13px;
      }

      .spread {
        grid-template-columns: 1fr;
      }

      .viewer {
        --page-max-height: 380px;
      }

      .viewer-controls {
        margin-left: 0;
      }

      .buy-row {
        align-items: stretch;
      }

      .buy-row .btn {
        width: 100%;
      }

      .progress-slider {
        height: 12px;
      }
    }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X00G23WVDJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-X00G23WVDJ');
</script>
</head>

<body>
  <main>
    <p class="nav">
      <a href="/">Home</a>
      <span class="dot">•</span>
      <a href="/pages/projects/">Projects</a>
      <span class="dot">•</span>
      <a href="/pages/writing/">Writing</a>
      <span class="dot">•</span>
      <a href="/pages/podcast/">QV Podcast</a>
      <span class="dot">•</span>
      <a href="/contact/">Contact</a>
    </p>

    <hr class="tight-hr">

    <h1>Relative Momentum</h1>
    <p class="viewer-intro">
      A collection of poems, lyrics, designs, and photographs as a royalty-free,
      project. All content is free to remix, adapt, and share—by whomever, for
      whatever.
    </p>

    <div class="buy-row">
      <a class="btn"
         href="https://a.co/d/fbTRmg4"
         target="_blank" rel="noopener noreferrer">
        Buy on Amazon
      </a>
      <div class="viewer-controls" role="group" aria-label="Page navigation">
        <button class="icon-btn" type="button" id="prev-button" aria-label="Previous pages" data-tooltip="Previous">◀</button>
        <button class="icon-btn" type="button" id="next-button" aria-label="Next pages" data-tooltip="Next">▶</button>
        <button class="icon-btn" type="button" id="fullscreen-button" aria-label="Open full screen viewer" data-tooltip="Full screen">⛶</button>
      </div>
    </div>

    <section class="viewer" aria-label="Relative Momentum ebook viewer">

      <div class="loading-indicator" id="loading-indicator" aria-live="polite"></div>

      <div class="spread" id="spread"></div>

      <div class="progress-wrap" aria-label="Reading progress">
        <input class="progress-slider" id="progress-slider" type="range" min="1" max="112" value="1" aria-label="Reading progress slider" />
      </div>
    </section>

    <div class="modal fullscreen-modal" id="fullscreen-modal" aria-hidden="true">
      <div class="modal-backdrop" data-close="fullscreen"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-label="Full screen reader">
        <div class="fullscreen-header">
          <h2>Relative Momentum — Full Screen</h2>
          <div class="fullscreen-actions" role="group" aria-label="Full screen page navigation">
            <button class="icon-btn" type="button" id="fullscreen-prev" aria-label="Previous pages" data-tooltip="Previous">◀</button>
            <button class="icon-btn" type="button" id="fullscreen-next" aria-label="Next pages" data-tooltip="Next">▶</button>
            <button class="modal-close" type="button" data-close="fullscreen" aria-label="Close full screen">✕</button>
          </div>
        </div>
        <section class="viewer fullscreen-viewer" aria-label="Full screen Relative Momentum ebook viewer">
          <div class="loading-indicator" id="fullscreen-loading" aria-live="polite"></div>
          <div class="spread" id="fullscreen-spread"></div>
          <div class="progress-wrap" aria-label="Reading progress">
            <input class="progress-slider" id="fullscreen-progress" type="range" min="1" max="112" value="1" aria-label="Reading progress slider" />
          </div>
        </section>
      </div>
    </div>

    <div class="modal zoom-modal" id="zoom-modal" aria-hidden="true">
      <div class="modal-backdrop" data-close="zoom"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-label="Zoomed page">
        <button class="modal-close" type="button" data-close="zoom" aria-label="Close zoom">✕</button>
        <img class="zoom-image" id="zoom-image" alt="Zoomed page" />
      </div>
    </div>
  </main>

  <script>
    const TOTAL_PAGES = 112;
    const IMAGE_BASE = "https://pub-7efa5866e0ab41af9e691f0820376dfc.r2.dev/pages/";

    const spread = document.getElementById("spread");
    const fullscreenSpread = document.getElementById("fullscreen-spread");
    const loadingIndicator = document.getElementById("loading-indicator");
    const fullscreenLoading = document.getElementById("fullscreen-loading");
    const prevButton = document.getElementById("prev-button");
    const nextButton = document.getElementById("next-button");
    const fullscreenButton = document.getElementById("fullscreen-button");
    const fullscreenModal = document.getElementById("fullscreen-modal");
    const fullscreenPrev = document.getElementById("fullscreen-prev");
    const fullscreenNext = document.getElementById("fullscreen-next");
    const progressSlider = document.getElementById("progress-slider");
    const fullscreenProgress = document.getElementById("fullscreen-progress");
    const zoomModal = document.getElementById("zoom-modal");
    const zoomImage = document.getElementById("zoom-image");

    const mobileQuery = window.matchMedia("(max-width: 899px)");
    const viewer = document.querySelector(".viewer");
    const fullscreenViewer = document.querySelector(".fullscreen-viewer");
    let currentPage = 1;
    let lastWheelTime = 0;
    let lastDirection = "forward";
    let touchStartX = 0;
    let touchStartY = 0;

    const clampPage = (page) => Math.min(Math.max(page, 1), TOTAL_PAGES);

    const isMobile = () => mobileQuery.matches;

    const snapToSpreadStart = (page) => {
      if (isMobile()) {
        return clampPage(page);
      }
      const snapped = page % 2 === 0 ? page - 1 : page;
      return clampPage(snapped);
    };

    const updateHash = (page) => {
      const newHash = `#p=${page}`;
      if (window.location.hash !== newHash) {
        window.location.hash = newHash;
      }
    };

    const parseHash = () => {
      const match = window.location.hash.match(/p=(\d+)/);
      if (!match) return 1;
      return clampPage(parseInt(match[1], 10));
    };

    const formatPageNumber = (page) => page.toString().padStart(3, "0");

    const setLoadingFor = (targetIndicator, isLoading, message = "Loading pages…") => {
      if (!targetIndicator) return;
      targetIndicator.textContent = isLoading ? message : "";
    };

    const updatePageMaxHeight = (targetViewer, targetSpread) => {
      if (!targetViewer || !targetSpread) return;
      const spreadTop = targetSpread.getBoundingClientRect().top;
      const viewportPadding = 24;
      const available = window.innerHeight - spreadTop - viewportPadding;
      const minHeight = isMobile() ? 220 : 260;
      const maxHeight = isMobile() ? 460 : 560;
      const nextHeight = Math.max(minHeight, Math.min(available, maxHeight));
      targetViewer.style.setProperty("--page-max-height", `${nextHeight}px`);
    };

    const preloadNext = (page) => {
      const pagesToLoad = isMobile() ? [page + 1] : [page + 2, page + 3];
      pagesToLoad
        .map(clampPage)
        .filter((p) => p > 0 && p <= TOTAL_PAGES)
        .forEach((p) => {
          const img = new Image();
          img.src = `${IMAGE_BASE}page-${formatPageNumber(p)}.jpg`;
        });
    };

    const createPageFrame = (page) => {
      const frame = document.createElement("div");
      frame.className = "page-frame";
      frame.dataset.page = page;
      const sheet = document.createElement("div");
      sheet.className = "page-sheet";
      const shade = document.createElement("div");
      shade.className = "page-shade";

      if (page > TOTAL_PAGES || page < 1) {
        frame.dataset.page = "";
        sheet.appendChild(shade);
        frame.appendChild(sheet);
        return frame;
      }

      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = `Relative Momentum page ${page}`;
      img.src = `${IMAGE_BASE}page-${formatPageNumber(page)}.jpg`;

      img.addEventListener("error", () => {
        sheet.innerHTML = "";
        const missing = document.createElement("div");
        missing.className = "missing-page";
        missing.textContent = `Page ${page} is unavailable.`;
        sheet.appendChild(missing);
      });

      sheet.appendChild(img);
      sheet.appendChild(shade);
      frame.appendChild(sheet);
      return frame;
    };

    const renderPages = (page, targetSpread, targetViewer, targetIndicator) => {
      targetSpread.classList.add("turning");
      targetSpread.dataset.direction = lastDirection;
      setLoadingFor(targetIndicator, true);
      updatePageMaxHeight(targetViewer, targetSpread);
      targetSpread.innerHTML = "";

      const pages = isMobile() ? [page] : [page, page + 1];
      const frames = pages.map(createPageFrame);
      frames.forEach((frame) => targetSpread.appendChild(frame));

      const images = Array.from(targetSpread.querySelectorAll("img"));
      const onImageDone = () => {
        const allDone = images.every((img) => img.complete);
        if (allDone) {
          setLoadingFor(targetIndicator, false);
        }
      };

      if (images.length === 0) {
        setLoadingFor(targetIndicator, false, "No pages to display.");
      } else {
        images.forEach((img) => {
          if (img.complete) {
            onImageDone();
          } else {
            img.addEventListener("load", onImageDone, { once: true });
            img.addEventListener("error", onImageDone, { once: true });
          }
        });
      }

      window.setTimeout(() => targetSpread.classList.remove("turning"), 420);
      preloadNext(page);
    };

    const updateProgress = () => {
      const progress = ((currentPage - 1) / (TOTAL_PAGES - 1)) * 100;
      [progressSlider, fullscreenProgress].forEach((slider) => {
        if (!slider) return;
        slider.value = currentPage;
        slider.style.setProperty("--progress", `${progress}%`);
      });
    };

    const currentStep = () => {
      if (isMobile()) return 1;
      return 2;
    };

    const goToPage = (page) => {
      const target = snapToSpreadStart(page);
      currentPage = target;
      updateHash(target);
      renderPages(target, spread, viewer, loadingIndicator);
      if (fullscreenModal.classList.contains("open")) {
        renderPages(target, fullscreenSpread, fullscreenViewer, fullscreenLoading);
      }
      updateProgress();
    };

    const goNext = () => {
      const step = currentStep();
      lastDirection = "forward";
      goToPage(clampPage(currentPage + step));
    };

    const goPrev = () => {
      const step = currentStep();
      lastDirection = "backward";
      goToPage(clampPage(currentPage - step));
    };

    prevButton.addEventListener("click", goPrev);
    nextButton.addEventListener("click", goNext);
    fullscreenPrev.addEventListener("click", goPrev);
    fullscreenNext.addEventListener("click", goNext);

    window.addEventListener("keydown", (event) => {
      if (event.key === "ArrowRight") {
        goNext();
      }
      if (event.key === "ArrowLeft") {
        goPrev();
      }
      if (event.key === "Escape" && fullscreenModal.classList.contains("open")) {
        fullscreenModal.classList.remove("open");
        fullscreenModal.setAttribute("aria-hidden", "true");
      }
      if (event.key === "Escape" && zoomModal.classList.contains("open")) {
        closeZoom();
      }
    });

    const handleWheel = (event) => {
      if (isMobile()) {
        return;
      }
      const now = Date.now();
      const timeDelta = Math.max(16, now - lastWheelTime);
      const delta = Math.abs(event.deltaX) > Math.abs(event.deltaY)
        ? event.deltaX
        : event.deltaY;
      if (Math.abs(delta) < 10) {
        return;
      }
      event.preventDefault();
      const velocity = Math.abs(delta) / timeDelta;
      const multiplier = velocity > 3.5 ? 2 : 1;
      const step = currentStep();
      const jump = step * multiplier;
      lastWheelTime = now;
      if (delta > 0) {
        lastDirection = "forward";
        goToPage(clampPage(currentPage + jump));
      } else {
        lastDirection = "backward";
        goToPage(clampPage(currentPage - jump));
      }
    };

    spread.addEventListener("wheel", handleWheel, { passive: false });
    fullscreenSpread.addEventListener("wheel", handleWheel, { passive: false });


    const handleTouchStart = (event) => {
      const touch = event.touches?.[0];
      if (!touch) return;
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    };

    const handleTouchEnd = (event) => {
      const touch = event.changedTouches?.[0];
      if (!touch) return;

      const deltaX = touch.clientX - touchStartX;
      const deltaY = touch.clientY - touchStartY;

      if (Math.abs(deltaX) < 45 || Math.abs(deltaX) < Math.abs(deltaY)) {
        return;
      }

      if (deltaX < 0) {
        goNext();
      } else {
        goPrev();
      }
    };

    [spread, fullscreenSpread].forEach((targetSpread) => {
      targetSpread.addEventListener("touchstart", handleTouchStart, { passive: true });
      targetSpread.addEventListener("touchend", handleTouchEnd, { passive: true });
    });

    window.addEventListener("hashchange", () => {
      goToPage(parseHash());
    });

    mobileQuery.addEventListener("change", () => {
      goToPage(currentPage);
    });

    window.addEventListener("resize", () => {
      updatePageMaxHeight(viewer, spread);
      if (fullscreenModal.classList.contains("open")) {
        updatePageMaxHeight(fullscreenViewer, fullscreenSpread);
      }
    });

    [progressSlider, fullscreenProgress].forEach((slider) => {
      slider.addEventListener("input", (event) => {
        const nextPage = parseInt(event.target.value, 10);
        lastDirection = nextPage >= currentPage ? "forward" : "backward";
        goToPage(nextPage);
      });
    });

    const openZoom = (page) => {
      if (!page) return;
      zoomImage.src = `${IMAGE_BASE}page-${formatPageNumber(page)}.jpg`;
      zoomImage.alt = `Relative Momentum page ${page}`;
      zoomModal.classList.add("open");
      zoomModal.setAttribute("aria-hidden", "false");
    };

    const closeZoom = () => {
      zoomModal.classList.remove("open");
      zoomModal.setAttribute("aria-hidden", "true");
      zoomImage.removeAttribute("src");
    };

    [spread, fullscreenSpread].forEach((targetSpread) => {
      targetSpread.addEventListener("click", (event) => {
        const frame = event.target.closest(".page-frame");
        const page = parseInt(frame?.dataset?.page || "", 10);
        if (!Number.isNaN(page)) {
          openZoom(page);
        }
      });
    });

    fullscreenButton.addEventListener("click", () => {
      fullscreenModal.classList.add("open");
      fullscreenModal.setAttribute("aria-hidden", "false");
      renderPages(currentPage, fullscreenSpread, fullscreenViewer, fullscreenLoading);
      updateProgress();
    });

    fullscreenModal.addEventListener("click", (event) => {
      if (event.target?.dataset?.close === "fullscreen") {
        fullscreenModal.classList.remove("open");
        fullscreenModal.setAttribute("aria-hidden", "true");
      }
    });

    zoomModal.addEventListener("click", (event) => {
      if (event.target?.dataset?.close === "zoom") {
        closeZoom();
      }
    });

    const initialPage = snapToSpreadStart(parseHash());
    currentPage = initialPage;
    renderPages(initialPage, spread, viewer, loadingIndicator);
    updateProgress();
  </script>
</body>
</html>
