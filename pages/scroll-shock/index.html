<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scroll Shock Absorber Demo</title>
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    .demo-shell { max-width: 860px; margin: 0 auto; }
    .demo-panel {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: color-mix(in oklab, var(--card) 85%, black);
      padding: 0;
      overflow: hidden;
    }
    #scrollRoot {
      height: min(72vh, 700px);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      touch-action: pan-y;
      scrollbar-gutter: stable;
    }
    .scroll-content {
      will-change: transform;
      transform: translateY(0);
      padding: 1rem 1.1rem 2rem;
    }
    .demo-block { padding: .9rem 1rem; margin: .8rem 0; border-radius: 10px; border: 1px solid var(--line); }
    .demo-block:nth-child(odd) { background: rgba(255,255,255,.02); }
    .controls {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: .86rem;
      line-height: 1.45;
      white-space: pre-wrap;
      padding: .85rem 1rem;
      border-top: 1px solid var(--line);
      margin: 0;
    }
  </style>
</head>
<body>
  <main class="demo-shell">
    <p class="nav">
      <a href="/">Home</a>
      <span class="dot">•</span>
      <a href="/pages/projects/">Projects</a>
      <span class="dot">•</span>
      <a href="/pages/scroll-shock/">Scroll Shock Absorber Demo</a>
    </p>

    <h1>Scroll Shock Absorber</h1>
    <p>
      This demo uses a dedicated scroll container and a near-critically damped spring-damper to absorb overscroll energy at boundaries.
      Native momentum scrolling remains untouched while in-range, while edge impulses are transformed into constrained, quickly-settling motion.
    </p>

    <section class="demo-panel" aria-label="Shock absorber demo panel">
      <div id="scrollRoot">
        <div class="scroll-content" id="scrollContent"></div>
      </div>
      <p class="controls" id="tuning"></p>
    </section>
  </main>

  <script src="/assets/physics.js"></script>
  <script src="/assets/scroll-shock-absorber.js"></script>
  <script>
    const content = document.getElementById('scrollContent');
    content.innerHTML = Array.from({ length: 38 }, (_, i) => (
      `<article class="demo-block">
        <h3>Section ${i + 1}</h3>
        <p>Long-form content placeholder to create realistic scroll travel. Try a fast wheel/trackpad flick or a hard touch pull when you are at the very top or bottom boundary. The edge should compress and settle instead of hard-bouncing.</p>
      </article>`
    )).join('');

    // Tuning notes:
    // - "Softer edge": lower stiffness and slightly lower dampingRatio.
    // - "Tighter edge": higher stiffness and dampingRatio near 1.0.
    // - jerkLimit controls acceleration smoothness under sudden input.
    const spring = window.SitePhysics.PHYSICS.spring;
    const params = {
      mass: spring.mass,
      stiffness: Math.round(spring.stiffness * 0.78),
      stiffnessByDisplacement: 1.9,
      dampingRatio: 0.96,
      dampingByVelocity: 0.018,
      jerkLimit: 3200,
      inputGain: 0.34,
      inputVelocityGain: 30,
      maxOverscrollPx: 66,
      boundaryEpsilonTop: 1,
      boundaryEpsilonBottom: 3
    };

    document.getElementById('tuning').textContent =
`Tunable parameters:
${JSON.stringify(params, null, 2)}

Integration:
1) Use a dedicated container (#scrollRoot) with overflow:auto + -webkit-overflow-scrolling: touch.
2) Keep content in one child wrapper (.scroll-content) so transform translateY can be applied.
3) Input capture happens only at boundaries; in-range native momentum is untouched.
4) const absorber = new ScrollShockAbsorber(scrollRoot, params); absorber.init();
5) On teardown: absorber.destroy();`;

    const absorber = new ScrollShockAbsorber(document.getElementById('scrollRoot'), {
      ...params,
      content: document.getElementById('scrollContent')
    });
    absorber.init();
  </script>
</body>
</html>
