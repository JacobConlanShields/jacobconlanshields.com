<main class="wrap">
  <p class="nav">
    <a href="/">← Back to home</a> ·
    <a href="/pages/projects/">Projects</a>
  </p>

  <h1>Podcast</h1>
  <p class="muted">Rows are playlists. They auto-update as you add videos on YouTube.</p>

  <section class="row" data-title="Full Podcast (Latest)" data-list="PLcDYjJATsN-Nn0Fs5HLuIq5EIzDcA9tgg"></section>
  <section class="row" data-title="Highlight Episodes" data-list="PLcDYjJATsN-OGocXwl1Hkqb3HWdSf6GA0"></section>

  <div id="playerModal" class="modal" aria-hidden="true">
    <div class="modal-inner">
      <button id="closeModal" class="close">Close</button>
      <div class="player">
        <iframe id="playerFrame" title="YouTube Player" frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
      </div>
    </div>
  </div>
</main>

<style>
  .wrap{max-width:980px;margin:50px auto;padding:0 20px}
  .nav{margin:0 0 24px 0}
  .muted{opacity:.75;margin:0 0 30px 0}
  .row{margin:34px 0}
  .row h2{margin:0 0 12px 0}
  .strip{
    display:flex; gap:12px; overflow-x:auto; padding:10px 6px;
    scroll-snap-type:x mandatory;
  }
  .card{
    flex:0 0 260px; scroll-snap-align:start;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px; overflow:hidden;
    background:rgba(255,255,255,.03);
    cursor:pointer;
  }
  .thumb{width:100%; height:146px; object-fit:cover; display:block}
  .meta{padding:10px 12px}
  .title{font-weight:600; font-size:14px; line-height:1.3}
  .openAll{margin-left:10px; font-size:13px; opacity:.85}
  .controls{display:flex; align-items:baseline; justify-content:space-between}
  .btns{display:flex; gap:8px}
  .btn{
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.04);
    color:inherit;
    border-radius:10px;
    padding:6px 10px;
    cursor:pointer;
  }

  /* Modal */
  .modal{
    position:fixed; inset:0;
    background:rgba(0,0,0,.65);
    display:none;
    align-items:center; justify-content:center;
    padding:24px;
  }
  .modal[aria-hidden="false"]{display:flex}
  .modal-inner{
    width:min(980px, 100%);
    background:#0f0f10;
    border:1px solid rgba(255,255,255,.14);
    border-radius:16px;
    overflow:hidden;
  }
  .close{
    width:100%;
    text-align:right;
    padding:12px 14px;
    background:transparent;
    border:0;
    color:inherit;
    cursor:pointer;
    opacity:.85;
  }
  .player{position:relative; padding-top:56.25%;}
  .player iframe{position:absolute; inset:0; width:100%; height:100%;}
</style>

<script>
  // Pull the first N videos from the playlist embed page (no CORS issues in practice).
  const MAX_ITEMS = 18;

  function ytEmbedPlaylistUrl(listId){
    return `https://www.youtube.com/embed/videoseries?list=${encodeURIComponent(listId)}`;
  }

  // This endpoint is public and returns the “videoseries” embed HTML which contains video ids.
  // We parse video IDs from the returned HTML.
  async function getPlaylistVideoIds(listId){
    const url = ytEmbedPlaylistUrl(listId);
    const res = await fetch(url);
    const html = await res.text();

    // video IDs show up as "videoId":"XXXXXXXXXXX"
    const ids = [];
    const re = /"videoId":"([a-zA-Z0-9_-]{11})"/g;
    let m;
    while ((m = re.exec(html)) !== null) {
      const id = m[1];
      if (!ids.includes(id)) ids.push(id);
      if (ids.length >= MAX_ITEMS) break;
    }
    return ids;
  }

  function thumbUrl(id){
    return `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
  }

  function openVideo(id, listId){
    const iframe = document.getElementById("playerFrame");
    // Keep playlist context so next/prev works inside the player
    iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1&rel=0&list=${encodeURIComponent(listId)}`;
    const modal = document.getElementById("playerModal");
    modal.setAttribute("aria-hidden","false");
  }

  function closeModal(){
    const iframe = document.getElementById("playerFrame");
    iframe.src = "";
    document.getElementById("playerModal").setAttribute("aria-hidden","true");
  }

  document.getElementById("closeModal").addEventListener("click", closeModal);
  document.getElementById("playerModal").addEventListener("click", (e)=>{
    if(e.target.id === "playerModal") closeModal();
  });
  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeModal();
  });

  async function renderRow(section){
    const title = section.dataset.title;
    const listId = section.dataset.list;

    section.innerHTML = `
      <div class="controls">
        <div>
          <h2>${title}</h2>
        </div>
        <div class="btns">
          <a class="btn" href="https://www.youtube.com/playlist?list=${encodeURIComponent(listId)}" target="_blank" rel="noopener">Open on YouTube</a>
        </div>
      </div>
      <div class="strip" role="list"></div>
    `;

    const strip = section.querySelector(".strip");

    try{
      const ids = await getPlaylistVideoIds(listId);
      if(!ids.length){
        strip.innerHTML = `<div class="muted">No videos found for this playlist.</div>`;
        return;
      }

      for(const id of ids){
        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute("role","listitem");
        card.innerHTML = `
          <img class="thumb" src="${thumbUrl(id)}" alt="">
          <div class="meta"><div class="title">Play</div></div>
        `;
        card.addEventListener("click", ()=> openVideo(id, listId));
        strip.appendChild(card);
      }
    } catch(err){
      strip.innerHTML = `<div class="muted">Could not load playlist right now.</div>`;
    }
  }

  document.querySelectorAll(".row").forEach(renderRow);
</script>
