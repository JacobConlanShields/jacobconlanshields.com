<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="https://pub-aad15324564c43c49955b96d781f71eb.r2.dev/JCS%20Logo%20Black%20Background.png" />
  <title>Quality Values Podcast — Jacob Shields</title>
  <!-- Shared stylesheet handles the grid, cards, buttons, and modal. -->
  <link rel="stylesheet" href="/assets/styles.css" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X00G23WVDJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-X00G23WVDJ');
</script>
</head>

<body>
  <main class="podcast-page">
    <!-- Lightweight nav for consistency across the site. -->
    <p class="nav">
      <a href="/">← Back to home</a>
      <span class="dot">•</span>
      <a href="/pages/projects/">Projects</a>
      <span class="dot">•</span>
      <a href="/contact/">Contact</a>
    </p>

    <!-- ONE grid only -->
    <section class="podcast-topgrid">

      <!-- LEFT COLUMN -->
      <div class="top-left">
        <!-- Page intro describes the overall theme of the show. -->
        <h1 class="podcast-title">Quality Values Podcast</h1>

        <p class="lede">
          Core Question: What are your values in the context of your story?<br>
          Long-form conversations about values, craft, and systems — with people I’m learning from.
        </p>

        <a class="btn"
           href="https://www.youtube.com/playlist?list=PLcDYjJATsN-Nn0Fs5HLuIq5EIzDcA9tgg"
           target="_blank" rel="noopener noreferrer">
          Open on YouTube
        </a>

        <hr class="tight-hr">

        <!-- 1) Full Podcast (Latest) -->
        <!-- Each row-block is a horizontal carousel populated by JS below. -->
        <section class="row-block row-block--tight">
          <div class="row-head">
            <h2 class="row-title">Full Podcast (Latest)</h2>
            <div class="row-controls">
              <button class="icon-btn" type="button" aria-label="Scroll left"  data-row="row-full" data-dir="-1">◀</button>
              <button class="icon-btn" type="button" aria-label="Scroll right" data-row="row-full" data-dir="1">▶</button>
            </div>
          </div>
          <div class="status" id="status-full"></div>
          <div class="row row--small" id="row-full"></div>
        </section>

        <hr class="tight-hr">

        <!-- 2) Highlight Episodes -->
        <section class="row-block row-block--tight">
          <div class="row-head">
            <h2 class="row-title">Highlight Episodes</h2>
            <div class="row-controls">
              <button class="icon-btn" type="button" aria-label="Scroll left"  data-row="row-highlights" data-dir="-1">◀</button>
              <button class="icon-btn" type="button" aria-label="Scroll right" data-row="row-highlights" data-dir="1">▶</button>
            </div>
          </div>
          <div class="status" id="status-highlights"></div>
          <div class="row row--small" id="row-highlights"></div>
        </section>

        <hr class="tight-hr">

        <!-- 3) Movement Episodes -->
        <section class="row-block row-block--tight">
          <div class="row-head">
            <h2 class="row-title">Movement Episodes</h2>
            <div class="row-controls">
              <button class="icon-btn" type="button" aria-label="Scroll left"  data-row="row-movement" data-dir="-1">◀</button>
              <button class="icon-btn" type="button" aria-label="Scroll right" data-row="row-movement" data-dir="1">▶</button>
            </div>
          </div>
          <div class="status" id="status-movement"></div>
          <div class="row row--small" id="row-movement"></div>
        </section>

        <hr class="tight-hr">

        <!-- 4) Science & Sustainability -->
        <section class="row-block row-block--tight">
          <div class="row-head">
            <h2 class="row-title">Science &amp; Sustainability</h2>
            <div class="row-controls">
              <button class="icon-btn" type="button" aria-label="Scroll left"  data-row="row-science" data-dir="-1">◀</button>
              <button class="icon-btn" type="button" aria-label="Scroll right" data-row="row-science" data-dir="1">▶</button>
            </div>
          </div>
          <div class="status" id="status-science"></div>
          <div class="row row--small" id="row-science"></div>
        </section>

        <hr class="tight-hr">

        <!-- 5) Entrepreneurship Episodes -->
        <section class="row-block row-block--tight">
          <div class="row-head">
            <h2 class="row-title">Entrepreneurship Episodes</h2>
            <div class="row-controls">
              <button class="icon-btn" type="button" aria-label="Scroll left"  data-row="row-entrepreneurship" data-dir="-1">◀</button>
              <button class="icon-btn" type="button" aria-label="Scroll right" data-row="row-entrepreneurship" data-dir="1">▶</button>
            </div>
          </div>
          <div class="status" id="status-entrepreneurship"></div>
          <div class="row row--small" id="row-entrepreneurship"></div>
        </section>
      </div>

      <!-- RIGHT COLUMN: Clips (ONLY ONCE) -->
      <!-- This column is sticky so clips stay visible while you scroll. -->
      <aside class="top-right">
        <div class="row-head row-head--clips">
          <h2 class="row-title">Clips</h2>
          <div class="row-controls">
            <button class="icon-btn" type="button" aria-label="Scroll up" data-row="row-clips" data-dir="-1" data-axis="y">▲</button>
            <button class="icon-btn" type="button" aria-label="Scroll down" data-row="row-clips" data-dir="1" data-axis="y">▼</button>
          </div>
        </div>
      
        <div class="status" id="status-clips"></div>
      
        <div class="clips-viewport">
          <div class="clips-rail" id="row-clips"></div>
        </div>
      </aside>


    </section>
  </main>

  <!-- ===== ONE modal player ===== -->
  <!-- Cards open the modal so we can play videos without leaving the page. -->
  <div class="modal" id="playerModal" aria-hidden="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Video player">
      <button class="modal-close" data-close aria-label="Close">✕</button>
      <div class="player-wrap" id="playerWrap"></div>
    </div>
  </div>

  <script>
    // Playlist IDs (Quality Values).
    // Each playlist maps to a visual section above.
    const PLAYLIST_FULL            = "PLcDYjJATsN-Nn0Fs5HLuIq5EIzDcA9tgg";
    const PLAYLIST_HIGHLIGHTS      = "PLcDYjJATsN-OGocXwl1Hkqb3HWdSf6GA0";
    const PLAYLIST_MOVEMENT        = "PLcDYjJATsN-Mbc7QGlLSuLgeQZzDzS9KY";
    const PLAYLIST_SCIENCE         = "PLcDYjJATsN-PtE4LDtPYqaJ7d3lx3Ov4r";
    const PLAYLIST_ENTREPRENEURSHIP= "PLcDYjJATsN-Msn3AQKaegXhSZdkiLVsgC";
    const PLAYLIST_CLIPS           = "PLcDYjJATsN-NiSRQwR9BepKMA0LiV6t-p";

    // "Counts" = how many videos to show in each carousel/column
    const COUNT_FULL            = 10;
    const COUNT_HIGHLIGHTS      = 10;
    const COUNT_MOVEMENT        = 10;
    const COUNT_SCIENCE         = 10;
    const COUNT_ENTREPRENEURSHIP= 10;
    const COUNT_CLIPS           = 25;

    // YouTube playlist feed (XML)
    const FEED = (playlistId) => `https://www.youtube.com/feeds/videos.xml?playlist_id=${playlistId}`;

    // Proxy options (CORS-safe).
    // Try multiple known endpoints in parallel and use the first valid XML response.
    const PROXY_ENDPOINTS = [
      `${window.location.origin}/yt?url=`,
      "https://yt-feed-proxy.jacobconlanshields.workers.dev/?url=",
      "https://yt.jacobconlanshields.workers.dev/?url=",
      "https://yt-feed-proxy.jacobconlanshields.com/?url=",
    ];

    const FEED_REQUEST_TIMEOUT_MS = 6000;

    const CACHE_KEY_PREFIX = "yt-playlist-cache:";
    const STATIC_FALLBACK_URL = "/assets/podcast-fallback.json";
    let staticFallbackPromise = null;

    async function readStaticFallbackItems(playlistId) {
      if (!staticFallbackPromise) {
        staticFallbackPromise = fetch(STATIC_FALLBACK_URL, { cache: "no-store" })
          .then((resp) => (resp.ok ? resp.json() : {}))
          .catch(() => ({}));
      }

      const allItems = await staticFallbackPromise;
      const items = allItems?.[playlistId];
      return Array.isArray(items) ? items : [];
    }


    function readCachedItems(playlistId) {
      try {
        const raw = localStorage.getItem(CACHE_KEY_PREFIX + playlistId);
        const parsed = raw ? JSON.parse(raw) : [];
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function writeCachedItems(playlistId, items) {
      try {
        localStorage.setItem(CACHE_KEY_PREFIX + playlistId, JSON.stringify(items || []));
      } catch {
        // Ignore storage failures (private mode, quota, etc.).
      }
    }

    async function fetchWithTimeout(url, timeoutMs) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), timeoutMs);

      try {
        return await fetch(url, { signal: controller.signal });
      } finally {
        clearTimeout(timeout);
      }
    }

    async function fetchFeedViaProxy(feedUrl) {
      const attempts = PROXY_ENDPOINTS.map(async (proxyBase) => {
        const url = proxyBase + encodeURIComponent(feedUrl);
        const resp = await fetchWithTimeout(url, FEED_REQUEST_TIMEOUT_MS);
        if (!resp.ok) throw new Error(`Feed error: ${resp.status} via ${proxyBase}`);

        const xml = await resp.text();
        if (!xml?.trim().startsWith("<?xml")) {
          throw new Error(`Non-XML response via ${proxyBase}`);
        }

        return xml;
      });

      try {
        return await Promise.any(attempts);
      } catch (err) {
        throw new Error("Unable to load feed through available proxies.");
      }
    }

    function escapeHtml(s) {
      // Basic HTML escaping for titles injected into the page.
      return (s || "").replace(/[&<>"']/g, (c) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    function normalizeYouTubeThumb(url, videoId) {
      // Feed thumbnails may come from hosts like i1/i2/i4.ytimg.com, but CSP only allows i.ytimg.com.
      // Normalize to a stable HTTPS host so cards render consistently.
      const fallback = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
      if (!url) return fallback;

      try {
        const absolute = new URL(url, window.location.origin);
        const isYouTubeThumb = /(^|\.)ytimg\.com$/i.test(absolute.hostname);
        if (!isYouTubeThumb) return absolute.href;

        absolute.protocol = "https:";
        absolute.hostname = "i.ytimg.com";
        return absolute.href;
      } catch {
        return fallback;
      }
    }

    function parseFeed(xmlText) {
      // Turn YouTube's XML feed into a simple array of {title, videoId, thumb}.
      const doc = new DOMParser().parseFromString(xmlText, "text/xml");
      const entries = Array.from(doc.getElementsByTagName("entry"));

      return entries.map((e) => {
        const title = e.getElementsByTagName("title")[0]?.textContent?.trim() || "";
        const videoId =
          e.getElementsByTagName("yt:videoId")[0]?.textContent?.trim()
          || e.getElementsByTagName("videoId")[0]?.textContent?.trim()
          || "";

        const feedThumb = e.getElementsByTagName("media:thumbnail")[0]?.getAttribute("url") || "";
        const thumb = normalizeYouTubeThumb(feedThumb, videoId);

        return { title, videoId, thumb };
      }).filter(x => x.videoId);
    }

    function cardHTML(item) {
      // Returns the HTML for one video card.
      return `
        <button class="card" type="button" data-video="${item.videoId}" title="${escapeHtml(item.title)}">
          <div class="thumb">
            <img src="${item.thumb}" alt="${escapeHtml(item.title)}" loading="lazy" />
            <div class="play">▶</div>
          </div>
          <div class="card-title">${escapeHtml(item.title)}</div>
        </button>
      `;
    }

    async function loadPlaylistInto(rowId, statusId, playlistId, limit) {
      // Fetches playlist XML via proxy, then injects cards into a row.
      const row = document.getElementById(rowId);
      const status = document.getElementById(statusId);

      // guard against null
      if (!row || !status) return;

      status.textContent = "Loading…";

      try {
        const xml = await fetchFeedViaProxy(FEED(playlistId));

        const items = parseFeed(xml).slice(0, limit);

        if (!items.length) {
          status.textContent = "No videos found right now.";
          row.innerHTML = "";
          return;
        }

        row.innerHTML = items.map(cardHTML).join("");
        writeCachedItems(playlistId, items);
        status.textContent = "";
        row.dataset.feedSource = "live";
      } catch (err) {
        const cached = readCachedItems(playlistId);
        if (cached?.length) {
          row.innerHTML = cached.slice(0, limit).map(cardHTML).join("");
          status.textContent = "Live feed unavailable — showing last saved videos.";
          row.dataset.feedSource = "cache";
        } else {
          const staticFallback = await readStaticFallbackItems(playlistId);
          if (staticFallback?.length) {
            row.innerHTML = staticFallback.slice(0, limit).map(cardHTML).join("");
            status.textContent = "Live feed unavailable — showing backup videos.";
            row.dataset.feedSource = "static-fallback";
          } else {
            status.textContent = "Could not load videos right now.";
          }
        }
        console.error(err);
      }
    }

    // Modal player
    const modal = document.getElementById("playerModal");
    const playerWrap = document.getElementById("playerWrap");
    function openPlayer(videoId) {
      // Only allow expected YouTube IDs before injecting into iframe src.
      if (!/^[A-Za-z0-9_-]{6,20}$/.test(videoId || "")) return;

      // When a card is clicked, swap in an iframe with autoplay.
      modal.setAttribute("aria-hidden", "false");
      modal.classList.add("open");
      playerWrap.innerHTML =
        `<iframe
          src="https://www.youtube.com/embed/${videoId}?autoplay=1"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>`;
    }

    function closePlayer() {
      // Remove the iframe to stop playback and free memory.
      modal.setAttribute("aria-hidden", "true");
      modal.classList.remove("open");
      playerWrap.innerHTML = "";
    }

    // Scrolling helpers (x for horizontal rows, y for clips)
    function smoothStepScroll(el, axis, dir, fallbackStep) {
      const firstCard = el.querySelector(".card");
      const style = getComputedStyle(el);
      const gap = Number.parseFloat(style.gap || "0") || 0;

      let step = fallbackStep;
      if (firstCard) {
        const box = firstCard.getBoundingClientRect();
        step = axis === "y" ? (box.height + gap) : (box.width + gap);
      }

      if (axis === "y") {
        const maxTop = Math.max(0, el.scrollHeight - el.clientHeight);
        const targetTop = Math.max(0, el.scrollTop + (dir * step));
        const threshold = Math.max(10, step * 0.35);
        const nextTop = dir > 0 && (maxTop - targetTop) < threshold
          ? maxTop
          : dir < 0 && targetTop < threshold
            ? 0
            : Math.min(maxTop, targetTop);

        el.scrollTo({ top: nextTop, behavior: "smooth" });
        return;
      }

      const maxLeft = Math.max(0, el.scrollWidth - el.clientWidth);
      const targetLeft = Math.max(0, el.scrollLeft + (dir * step));
      const threshold = Math.max(10, step * 0.35);
      const nextLeft = dir > 0 && (maxLeft - targetLeft) < threshold
        ? maxLeft
        : dir < 0 && targetLeft < threshold
          ? 0
          : Math.min(maxLeft, targetLeft);

      el.scrollTo({ left: nextLeft, behavior: "smooth" });
    }

    function scrollRow(el, dir, axis) {
      if (!el) return;

      if (axis === "y") {
        const isMobile = window.matchMedia("(max-width: 900px)").matches;
        if (isMobile) {
          smoothStepScroll(el, "x", dir, 220);
          return;
        }

        smoothStepScroll(el, "y", dir, 220);
        return;
      }

      smoothStepScroll(el, "x", dir, Math.round(el.clientWidth * 0.88));
    }

    const swipeState = new WeakMap();

    function handleSwipeStart(event) {
      const rail = event.currentTarget;
      const touch = event.touches?.[0];
      if (!rail || !touch) return;

      swipeState.set(rail, {
        x: touch.clientX,
        y: touch.clientY,
      });
    }

    function handleSwipeEnd(event) {
      const rail = event.currentTarget;
      const start = swipeState.get(rail);
      const touch = event.changedTouches?.[0];
      if (!rail || !start || !touch) return;

      const deltaX = touch.clientX - start.x;
      const deltaY = touch.clientY - start.y;
      const horizontalSwipe = Math.abs(deltaX) >= 45 && Math.abs(deltaX) > Math.abs(deltaY);

      if (horizontalSwipe) {
        const dir = deltaX < 0 ? 1 : -1;
        smoothStepScroll(rail, "x", dir, Math.round(rail.clientWidth * 0.86));
      }

      swipeState.delete(rail);
    }

    function bindSwipeScrolling() {
      const rails = document.querySelectorAll('.row, .clips-rail');
      rails.forEach((rail) => {
        rail.addEventListener('touchstart', handleSwipeStart, { passive: true });
        rail.addEventListener('touchend', handleSwipeEnd, { passive: true });
        rail.addEventListener('touchcancel', () => swipeState.delete(rail), { passive: true });
      });
    }

    document.addEventListener("click", (e) => {
      // Event delegation keeps the HTML clean (no inline onclick).
      const card = e.target.closest(".card");
      if (card?.dataset.video) openPlayer(card.dataset.video);

      if (e.target.matches("[data-close]")) closePlayer();

      const scrollBtn = e.target.closest("[data-row][data-dir]");
      if (scrollBtn) {
        const axis = scrollBtn.dataset.axis || "x";
        const el = document.getElementById(scrollBtn.dataset.row);
        const dir = Number(scrollBtn.dataset.dir);
        scrollRow(el, dir, axis);
      }
    });

    document.addEventListener("keydown", (e) => {
      // Allow "Esc" to close the modal video.
      if (e.key === "Escape" && modal.classList.contains("open")) closePlayer();
    });

    bindSwipeScrolling();

    // Load playlists (order matters, matches page order)
    loadPlaylistInto("row-full", "status-full", PLAYLIST_FULL, COUNT_FULL);
    loadPlaylistInto("row-highlights", "status-highlights", PLAYLIST_HIGHLIGHTS, COUNT_HIGHLIGHTS);
    loadPlaylistInto("row-movement", "status-movement", PLAYLIST_MOVEMENT, COUNT_MOVEMENT);
    loadPlaylistInto("row-science", "status-science", PLAYLIST_SCIENCE, COUNT_SCIENCE);
    loadPlaylistInto("row-entrepreneurship", "status-entrepreneurship", PLAYLIST_ENTREPRENEURSHIP, COUNT_ENTREPRENEURSHIP);
    loadPlaylistInto("row-clips", "status-clips", PLAYLIST_CLIPS, COUNT_CLIPS);
  </script>
</body>
</html>
