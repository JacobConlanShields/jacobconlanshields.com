<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spincline</title>
  <link rel="stylesheet" href="/assets/styles.css" />
</head>
<body>
  <main>
    <p class="nav"><a href="/">← Back to home</a></p>
    <h1>Spincline</h1>
    <p>Design and build progress, finished products, and in-action footage.</p>

    <section class="row-block">
      <div class="row-head"><h2>Design &amp; Build</h2><div class="row-controls"><button class="icon-btn" data-row="row-design" data-dir="-1">◀</button><button class="icon-btn" data-row="row-design" data-dir="1">▶</button></div></div>
      <div class="status" id="status-design"></div>
      <div class="row media-row" id="row-design"></div>
    </section>

    <section class="row-block">
      <div class="row-head"><h2>Finished Products</h2><div class="row-controls"><button class="icon-btn" data-row="row-finished" data-dir="-1">◀</button><button class="icon-btn" data-row="row-finished" data-dir="1">▶</button></div></div>
      <div class="status" id="status-finished"></div>
      <div class="row media-row" id="row-finished"></div>
    </section>

    <section class="row-block">
      <div class="row-head"><h2>In Action</h2><div class="row-controls"><button class="icon-btn" data-row="row-action" data-dir="-1">◀</button><button class="icon-btn" data-row="row-action" data-dir="1">▶</button></div></div>
      <div class="status" id="status-action"></div>
      <div class="row media-row" id="row-action"></div>
    </section>
  </main>

  <script>
    async function loadCollection(collection, rowId, statusId) {
      const row = document.getElementById(rowId);
      const status = document.getElementById(statusId);
      status.textContent = 'Loading…';
      const resp = await fetch(`/api/media?collection=${collection}`);
      const data = await resp.json();
      const items = data.items || [];
      row.innerHTML = items.map((item) => {
        const media = item.media_type === 'video'
          ? `<video controls playsinline preload="metadata" ${item.posterUrl ? `poster="${item.posterUrl}"` : ''}><source src="${item.url}"></video>`
          : `<img src="${item.url}" alt="${item.title || 'Spincline image'}" loading="lazy">`;
        return `<article class="media-card card">${media}<div class="media-copy"><h3>${escapeHtml(item.title || '')}</h3><p>${escapeHtml(item.description || '')}</p></div></article>`;
      }).join('');
      status.textContent = items.length ? '' : 'No items yet.';
    }

    function escapeHtml(s) { return (s || '').replace(/[&<>"']/g, (c) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    function smoothStepScroll(el, dir) {
      const card = el.querySelector('.card');
      const gap = parseFloat(getComputedStyle(el).gap || 0);
      const width = card ? card.getBoundingClientRect().width + gap : el.clientWidth * 0.88;
      el.scrollTo({ left: Math.max(0, el.scrollLeft + dir * width), behavior: 'smooth' });
    }

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-row][data-dir]');
      if (!btn) return;
      const row = document.getElementById(btn.dataset.row);
      smoothStepScroll(row, Number(btn.dataset.dir));
    });

    loadCollection('spincline_design_build', 'row-design', 'status-design');
    loadCollection('spincline_finished_products', 'row-finished', 'status-finished');
    loadCollection('spincline_in_action', 'row-action', 'status-action');
  </script>
</body>
</html>
